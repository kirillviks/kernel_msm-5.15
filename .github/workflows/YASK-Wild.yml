name: "Build YASK Wild"

env:
  OUT_DIR: "out"
  KERNEL_VERSION: "5.15"
  ANDROID_VERSION: "13"

on:
  schedule:
    - cron: '0 0 * * 0'
  workflow_dispatch:

jobs:
  build-kernels:
    name: "üêé Build YASK ${{ matrix.kernel.name }} kernel"
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        kernel:
          - name: "GKI"
            dir: "common_gki"
            repo_name: "common"
            repo_url: "https://android.googlesource.com/kernel/common"
            branch: "android13-5.15-lts"
            defconfig: "gki_defconfig"
            local_version: "-YASK-NEXT-GKI"
            output_name: "Image.gki.ksu"
            enable_ksu: true
            extra_patches:
              - "https://raw.githubusercontent.com/topnotchfreaks/kernel_patches/main/0001-scripts-sign-builds.patch"
          - name: "CLO"
            dir: "common_clo"
            repo_name: "clo"
            repo_url: "https://git.codelinaro.org/clo/la/kernel/msm-5.15.git"
            branch: "kernel.lnx.5.15.r16-rel"
            defconfig: "gki_defconfig"
            local_version: "-YASK-NEXT-CLO"
            output_name: "Image.clo.ksu"
            enable_ksu: true
            extra_patches:
              - "https://raw.githubusercontent.com/topnotchfreaks/kernel_patches/main/0001-scripts-sign-builds.patch"
          - name: "GKI-NoKSU"
            dir: "common_gki_noksu"
            repo_name: "common"
            repo_url: "https://android.googlesource.com/kernel/common"
            branch: "android13-5.15-lts"
            defconfig: "gki_defconfig"
            local_version: "-YAS-NEXT-GKI"
            output_name: "Image.gki.noksu"
            enable_ksu: false
            extra_patches:
              - "https://raw.githubusercontent.com/topnotchfreaks/kernel_patches/main/0001-scripts-sign-builds.patch"
          - name: "CLO-NoKSU"
            dir: "common_clo_noksu"
            repo_name: "clo"
            repo_url: "https://git.codelinaro.org/clo/la/kernel/msm-5.15.git"
            branch: "kernel.lnx.5.15.r16-rel"
            defconfig: "gki_defconfig"
            local_version: "-YASK-NEXT-CLO"
            output_name: "Image.clo.noksu"
            enable_ksu: false
            extra_patches:
              - "https://raw.githubusercontent.com/topnotchfreaks/kernel_patches/main/0001-scripts-sign-builds.patch"

    env:
      KERNEL_LOC_DIR: ${{ matrix.kernel.dir }}
      KERNEL_NAME: ${{ matrix.kernel.repo_name }}
      KERNEL_REPO: ${{ matrix.kernel.repo_url }}
      KERNEL_BRANCH: ${{ matrix.kernel.branch }}
      DEFCONFIG_NAME: ${{ matrix.kernel.defconfig }}
      LOCAL_VERSION: ${{ matrix.kernel.local_version }}
      OUTPUT_NAME: ${{ matrix.kernel.output_name }}
      WORK_DIR: ${{ github.workspace }}

    steps:
      - name: "‚ú® Setup workspace"
        run: |
          mkdir -p ${{ env.KERNEL_LOC_DIR }}
          echo "BUILD_TIME=$(date +'%Y-%m-%d')" >> $GITHUB_ENV
          sudo apt-get update -qq
          sudo apt-get install -y repo rsync aria2

      - name: "üåü Clone kernel source"
        working-directory: ./${{ env.KERNEL_LOC_DIR }}
        run: |
          git clone --recursive --branch ${{ env.KERNEL_BRANCH }} \
            ${{ env.KERNEL_REPO }} ${{ env.KERNEL_NAME }} --depth=1

      - name: "üì• Initialize AOSP repo and toolchains"
        working-directory: ${{ env.WORK_DIR }}
        run: |
          # Initialize AOSP repo
          repo init -u https://android.googlesource.com/kernel/manifest -b common-android13-5.15-lts --depth=1
          repo sync --optimized-fetch --prune -j8
          
          # Clean up existing repo and common directories
          rm -rf .repo
          rm -rf common

          # Download and setup custom clang toolchain
          aria2c -x 16 -s 16 -o prebuilts/clang/host/linux-x86/clang-r547379.tar.gz "https://github.com/topnotchfreaks/clang/releases/download/v1.0.0/clang-r547379.tar.gz"
          mkdir -p prebuilts/clang/host/linux-x86/clang-r547379
          tar -xzf prebuilts/clang/host/linux-x86/clang-r547379.tar.gz -C prebuilts/clang/host/linux-x86/clang-r547379
          rm -rf prebuilts/clang/host/linux-x86/clang-r547379.tar.gz

          # Remove unused clang for more space
          rm -rf prebuilts/clang/host/linux-x86/clang-3289846
          rm -rf prebuilts/clang/host/linux-x86/clang-r450784e
          rm -rf prebuilts/clang/host/linux-x86/clang-stable
          
          # Update build config constants
          sed -i \
           -e 's/^BRANCH=.*/BRANCH=android13-5.15/' \
           -e 's/^CLANG_VERSION=.*/CLANG_VERSION=r547379/' \
           ${{ env.KERNEL_LOC_DIR }}/${{ env.KERNEL_NAME }}/build.config.constants
          
          # Remove defconfig check (if exists)
          sed -i '/^POST_DEFCONFIG_CMDS="check_defconfig"/d' ${{ env.KERNEL_LOC_DIR }}/${{ env.KERNEL_NAME }}/build.config.gki || true

      - name: "üß© Configure kernel & patches"
        working-directory: ${{ env.KERNEL_LOC_DIR }}/${{ env.KERNEL_NAME }}
        run: |
          CONFIG_FILE="arch/arm64/configs/${{ env.DEFCONFIG_NAME }}"
          echo "CONFIG_LOCALVERSION=\"${{ env.LOCAL_VERSION }}-${{ env.BUILD_TIME }}\"" >> "$CONFIG_FILE"
          echo "CONFIG_LOCALVERSION_AUTO=n" >> "$CONFIG_FILE"

          # Helper
          apply_patch() {
            local url="$1"
            local file=$(basename "$url")
            curl -L -o "$file" "$url"
            patch -p1 < "$file" || echo "::warning::Hunks failed in $file"
            rm -f "$file"
          }

          # Common patches
          apply_patch "https://raw.githubusercontent.com/topnotchfreaks/kernel_patches/main/0001-gki-fixup.patch"

          # Kernel-specific patches
          echo '${{ toJSON(matrix.kernel.extra_patches) }}' | jq -r '.[]' | while read p; do
            [ -n "$p" ] && apply_patch "$p"
          done

      - name: "üîß Setup Wild-KSU with SUSFS"
        if: matrix.kernel.enable_ksu == true
        working-directory: ./${{ env.KERNEL_LOC_DIR }}/${{ env.KERNEL_NAME }}
        run: |
          set -e
          
          # Clean existing installations
          rm -rf ./KernelSU ./drivers/kernelsu ./Wild_KSU
          
          echo "üì¶ Installing Wild-KSU..."
          curl -LSs "https://raw.githubusercontent.com/WildKernels/Wild_KSU/wild/kernel/setup.sh" | bash -s stable
          
          if [ ! -d "Wild_KSU" ]; then
            echo "‚ùå ERROR: Wild_KSU directory not found after installation!"
            exit 1
          fi
          echo "‚úî Wild-KSU installed successfully"
          
          echo "üì¶ Cloning SUSFS4KSU..."
          git clone --depth=1 https://gitlab.com/simonpunk/susfs4ksu.git -b gki-android13-5.15
          
          if [ ! -d "susfs4ksu" ]; then
            echo "‚ùå ERROR: SUSFS4KSU clone failed!"
            exit 1
          fi
          
          # Apply SUSFS kernel patch
          echo "üîß Applying SUSFS kernel patch..."
          SUSFS_PATCH="susfs4ksu/kernel_patches/50_add_susfs_in_gki-android13-5.15.patch"
          
          if [ -f "$SUSFS_PATCH" ]; then
            if patch -p1 --forward < "$SUSFS_PATCH"; then
              echo "‚úÖ SUSFS kernel patch applied successfully"
            else
              echo "‚ö†Ô∏è Patch had some issues, but continuing..."
            fi
          else
            echo "‚ö†Ô∏è SUSFS patch file not found: $SUSFS_PATCH"
          fi
          
          # Force copy SUSFS source files
          echo "üìÑ Installing SUSFS source files..."
          mkdir -p fs include/linux
          
          if [ -f "susfs4ksu/kernel_patches/fs/susfs.c" ]; then
            cp -f susfs4ksu/kernel_patches/fs/susfs.c fs/susfs.c
            echo "‚úî Copied fs/susfs.c"
          else
            echo "‚ùå ERROR: fs/susfs.c not found in SUSFS repo!"
            exit 1
          fi
          
          if [ -f "susfs4ksu/kernel_patches/include/linux/susfs.h" ]; then
            cp -f susfs4ksu/kernel_patches/include/linux/susfs.h include/linux/susfs.h
            echo "‚úî Copied include/linux/susfs.h"
          else
            echo "‚ùå ERROR: include/linux/susfs.h not found!"
            exit 1
          fi
          
          if [ -f "susfs4ksu/kernel_patches/include/linux/susfs_def.h" ]; then
            cp -f susfs4ksu/kernel_patches/include/linux/susfs_def.h include/linux/susfs_def.h
            echo "‚úî Copied include/linux/susfs_def.h"
          else
            echo "‚ö†Ô∏è susfs_def.h not found, might not be needed"
          fi
          
          # Inject SUSFS integration into KernelSU
          echo "üì¶ Integrating SUSFS with Wild-KSU..."
          
          if [ -d "susfs4ksu/kernel_patches/KernelSU/kernel" ]; then
            cp -rf susfs4ksu/kernel_patches/KernelSU/kernel/* Wild_KSU/kernel/ || true
            echo "‚úî Copied SUSFS integration files to Wild_KSU/kernel/"
          fi
          
          # Apply KSU SUSFS patch with better error handling
          KSU_PATCH="susfs4ksu/kernel_patches/KernelSU/10_enable_susfs_for_ksu.patch"
          KSU_C_FILE="Wild_KSU/kernel/ksu.c"
          
          if [ ! -f "$KSU_C_FILE" ]; then
            echo "‚ùå ERROR: $KSU_C_FILE not found!"
            exit 1
          fi
          
          echo "üîß Integrating SUSFS into KSU initialization..."
          
          # Check if already patched
          if grep -q "susfs_init" "$KSU_C_FILE" 2>/dev/null; then
            echo "‚ö†Ô∏è SUSFS already integrated in ksu.c, skipping"
          else
            # Try applying patch first
            PATCH_SUCCESS=0
            if [ -f "$KSU_PATCH" ]; then
              cd Wild_KSU
              if patch -p1 --forward --dry-run < "../$KSU_PATCH" >/dev/null 2>&1; then
                patch -p1 < "../$KSU_PATCH" && PATCH_SUCCESS=1
                echo "‚úî Applied KSU SUSFS patch successfully"
              fi
              cd ..
            fi
            
            # Manual integration if patch failed
            if [ $PATCH_SUCCESS -eq 0 ]; then
              echo "‚ö†Ô∏è Patch failed or unavailable, applying manual integration..."
              
              # Add susfs.h include after other linux includes
              if ! grep -q "#include <linux/susfs.h>" "$KSU_C_FILE"; then
                sed -i '/#include <linux\/fs\.h>/a #include <linux/susfs.h>' "$KSU_C_FILE"
                echo "‚úî Added #include <linux/susfs.h>"
              fi
              
              # Add susfs_init() call in ksu_core_init()
              if ! grep -q "susfs_init()" "$KSU_C_FILE"; then
                # Find the ksu_core_init function and add susfs_init after ksu_core_init call
                sed -i '/ksu_core_init();/a \\tsusfs_init();' "$KSU_C_FILE" || \
                sed -i '/int __init ksu_init(/,/^}/{ /return 0;/i \\tsusfs_init(); }' "$KSU_C_FILE"
                echo "‚úî Added susfs_init() call"
              fi
            fi
          fi
          
          # Verify the integration
          echo "üîç Verifying SUSFS integration..."
          VERIFICATION_FAILED=0
          
          for file in fs/susfs.c include/linux/susfs.h; do
            if [ -f "$file" ]; then
              echo "‚úî Found: $file"
            else
              echo "‚ùå MISSING: $file"
              VERIFICATION_FAILED=1
            fi
          done
          
          if grep -q "susfs_init" "$KSU_C_FILE"; then
            echo "‚úî susfs_init() call verified in ksu.c"
          else
            echo "‚ùå MISSING: susfs_init() call in ksu.c"
            VERIFICATION_FAILED=1
          fi
          
          if grep -q "#include <linux/susfs.h>" "$KSU_C_FILE"; then
            echo "‚úî susfs.h include verified in ksu.c"
          else
            echo "‚ùå MISSING: susfs.h include in ksu.c"
            VERIFICATION_FAILED=1
          fi
          
          if [ $VERIFICATION_FAILED -eq 1 ]; then
            echo "‚ùå SUSFS integration verification FAILED!"
            echo "Dumping ksu.c header for debugging:"
            head -30 "$KSU_C_FILE"
            exit 1
          fi
          
          # Ensure drivers/kernelsu symlink exists
          if [ ! -L "drivers/kernelsu" ] && [ ! -d "drivers/kernelsu" ]; then
            ln -sf ../Wild_KSU drivers/kernelsu
            echo "‚úî Created drivers/kernelsu symlink"
          fi
          
          # Add Wild-KSU and SUSFS configs
          CONFIG_FILE="arch/arm64/configs/${{ env.DEFCONFIG_NAME }}"
          cat >> "$CONFIG_FILE" << 'EOF'
          CONFIG_KSU=y
          CONFIG_KPROBES=y
          CONFIG_HAVE_KPROBES=y
          CONFIG_KPROBE_EVENTS=y
          CONFIG_OVERLAY_FS=y
          CONFIG_KSU_SUSFS=y
          CONFIG_KSU_SUSFS_HAS_MAGIC_MOUNT=y
          CONFIG_KSU_SUSFS_SUS_PATH=y
          CONFIG_KSU_SUSFS_SUS_MOUNT=y
          CONFIG_KSU_SUSFS_AUTO_ADD_SUS_KSU_DEFAULT_MOUNT=y
          CONFIG_KSU_SUSFS_AUTO_ADD_SUS_BIND_MOUNT=y
          CONFIG_KSU_SUSFS_SUS_KSTAT=y
          CONFIG_KSU_SUSFS_TRY_UMOUNT=y
          CONFIG_KSU_SUSFS_AUTO_ADD_TRY_UMOUNT_FOR_BIND_MOUNT=y
          CONFIG_KSU_SUSFS_SPOOF_UNAME=y
          CONFIG_KSU_SUSFS_ENABLE_LOG=y
          CONFIG_KSU_SUSFS_HIDE_KSU_SUSFS_SYMBOLS=y
          CONFIG_KSU_SUSFS_SPOOF_CMDLINE_OR_BOOTCONFIG=y
          CONFIG_KSU_SUSFS_OPEN_REDIRECT=y
          CONFIG_KSU_SUSFS_SUS_SU=y
          EOF
          
          echo "‚úî Wild-KSU configs with SUSFS added"
          
          # Clean up
          rm -rf susfs4ksu
          
          echo "üéâ Wild-KSU with SUSFS fully integrated and verified!"

      - name: "‚öôÔ∏è Setup basic configs"
        working-directory: ${{ env.KERNEL_LOC_DIR }}/${{ env.KERNEL_NAME }}
        run: |
          CONFIG_FILE="./arch/arm64/configs/${{ env.DEFCONFIG_NAME }}"
          
          # Basic optimizations
          echo "CONFIG_KALLSYMS=y" >> "$CONFIG_FILE"

          # Performance configs
          cat >> "$CONFIG_FILE" << 'EOF'
          CONFIG_CC_OPTIMIZE_FOR_PERFORMANCE=y
          CONFIG_TCP_CONG_ADVANCED=y
          CONFIG_TCP_CONG_BIC=n
          CONFIG_TCP_CONG_WESTWOOD=y
          CONFIG_TCP_CONG_HTCP=n
          CONFIG_TCP_CONG_BBR=y
          CONFIG_DEFAULT_WESTWOOD=y
          CONFIG_OVERLAY_FS=y
          CONFIG_TMPFS_XATTR=y
          CONFIG_TMPFS_POSIX_ACL=y
          EOF
          
          echo "‚úÖ Basic configs added"

      - name: "üî® Build kernel"
        working-directory: ${{ env.WORK_DIR }}
        run: |
          LTO=thin \
          BUILD_CONFIG=${{ env.KERNEL_LOC_DIR }}/${{ env.KERNEL_NAME }}/build.config.gki.aarch64 \
          build/build.sh -j$(nproc --all)

      - name: "üìÅ Copy kernel image"
        working-directory: ${{ env.WORK_DIR }}/out/dist
        run: |
          cp Image "${{ env.OUTPUT_NAME }}"

      - name: "üì§ Upload kernel artifact"
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.kernel.name }}-kernel
          path: ${{ env.WORK_DIR }}/out/dist/${{ env.OUTPUT_NAME }}
          retention-days: 1

  package-kernels:
    name: "üì¶ Package Kernels"
    runs-on: ubuntu-latest
    needs: [build-kernels]
    steps:
      - name: "üì• Download kernel artifacts"
        uses: actions/download-artifact@v4
        with:
          path: ./artifacts/

      - name: "üì¶ Create release package"
        run: |
          set -e

          # Clone AnyKernel3
          git clone --depth=1 https://github.com/topnotchfreaks/AnyKernel3 -b YASK AnyKernel3

          # Copy kernel images
          find ./artifacts -name "Image.*" -exec cp {} AnyKernel3/ \;

          # Create banner
          cat > AnyKernel3/banner << 'EOF'
          ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
          ‚ïë                                                     ‚ïë
          ‚ïë          ‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó          ‚ïë
          ‚ïë          ‚ïö‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïî‚ïù          ‚ïë
          ‚ïë           ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù           ‚ïë
          ‚ïë            ‚ïö‚ñà‚ñà‚ïî‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ïö‚ïê‚ïê‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ñà‚ñà‚ïó           ‚ïë
          ‚ïë             ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïó          ‚ïë
          ‚ïë             ‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù          ‚ïë
          ‚ïë                                                     ‚ïë
          ‚ïë               Yet Another Stock Kernel              ‚ïë
          ‚ïë                   by @belowzeroiq                   ‚ïë
          ‚ïë                                                     ‚ïë
          ‚ïë              Powered by Github Actions              ‚ïë
          ‚ïë                                                     ‚ïë
          ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
          ‚ïë                                                     ‚ïë
          ‚ïë     Features:                                       ‚ïë
          ‚ïë     ‚Ä¢ Thin LTO + -O2 Optimization                   ‚ïë
          ‚ïë     ‚Ä¢ Extra TCP Congestion (BBR, Westwood)          ‚ïë
          ‚ïë     ‚Ä¢ AOSP clang-r547379                            ‚ïë
          ‚ïë     ‚Ä¢ Non-KSU & Wild-KSU support                    ‚ïë
          ‚ïë     ‚Ä¢ SUSFS integration (for KSU builds)            ‚ïë
          ‚ïë     ‚Ä¢ Metamodule Support                            ‚ïë
          ‚ïë                                                     ‚ïë
          ‚ïë     Info:                                           ‚ïë
          ‚ïë     ‚Ä¢ Supported Android: 13-16                      ‚ïë
          ‚ïë     ‚Ä¢ Supported Device:                             ‚ïë
          ‚ïë       Redmi Note 12 4G/NFC                          ‚ïë
          ‚ïë       Redmi Note 13 4G/NFC                          ‚ïë
          ‚ïë       Redmi Pad SE                                  ‚ïë
          ‚ïë                                                     ‚ïë
          ‚ïë     Please ensure:                                  ‚ïë
          ‚ïë     ‚Ä¢ Your device is compatible                     ‚ïë
          ‚ïë     ‚Ä¢ You have a backup of your current kernel      ‚ïë
          ‚ïë                                                     ‚ïë
          ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
          Installing YASK Kernel...
          EOF

          # Create ZIP
          ZIP_NAME="Anykernel3_YASK-WildKSU-AIO-FULL_$(date +'%Y-%m-%d').zip"
          cd AnyKernel3
          zip -r9 "../$ZIP_NAME" * -x .git/*
          cd ..
          
          echo "ZIP_NAME=$ZIP_NAME" >> $GITHUB_ENV
          echo "‚úÖ Package created: $ZIP_NAME"

      - name: "‚¨ÜÔ∏è Upload to GitHub Release"
        uses: softprops/action-gh-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
        with:
          files: ${{ env.ZIP_NAME }}
          tag_name: "YASK-NEXT"

      - name: "üéâ Send success notification with download link"
        if: success()
        run: |
          RELEASE_URL="https://github.com/${{ github.repository }}/releases/tag/YASK-NEXT"
          MESSAGE="üéâ <b>YASK Kernel Package Released!</b>%0A%0A"
          MESSAGE="${MESSAGE}‚úÖ All kernels built successfully%0A%0A"
          MESSAGE="${MESSAGE}üì¶ <b>Package:</b> <code>${{ env.ZIP_NAME }}</code>%0A"
          MESSAGE="${MESSAGE}üìä <b>Size:</b> ${{ env.ZIP_SIZE }}%0A"
          MESSAGE="${MESSAGE}üìÖ <b>Build Date:</b> ${{ env.BUILD_TIME }}%0A%0A"
          MESSAGE="${MESSAGE}üì• <b>Included Variants:</b>%0A"
          MESSAGE="${MESSAGE}‚Ä¢ GKI + Wild-KSU + SUSFS%0A"
          MESSAGE="${MESSAGE}‚Ä¢ CLO + Wild-KSU + SUSFS%0A"
          MESSAGE="${MESSAGE}‚Ä¢ GKI (No KSU)%0A"
          MESSAGE="${MESSAGE}‚Ä¢ CLO (No KSU)%0A%0A"
          MESSAGE="${MESSAGE}üîó <a href='${RELEASE_URL}'>Download Now</a>"
          
          curl -s -X POST "https://api.telegram.org/bot${{ env.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d chat_id="${{ env.TELEGRAM_CHAT_ID }}" \
            -d text="${MESSAGE}" \
            -d parse_mode="HTML" \
            -d disable_web_page_preview=true

      - name: "üíî Send failure notification"
        if: failure()
        run: |
          MESSAGE="‚ùå <b>YASK Kernel Package Failed!</b>%0A%0A"
          MESSAGE="${MESSAGE}‚ö†Ô∏è Package creation or upload failed%0A"
          MESSAGE="${MESSAGE}üìÖ <b>Time:</b> $(date +'%Y-%m-%d %H:%M:%S')%0A"
          MESSAGE="${MESSAGE}üîó <a href='https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}'>View Logs</a>"
          
          curl -s -X POST "https://api.telegram.org/bot${{ env.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d chat_id="${{ env.TELEGRAM_CHAT_ID }}" \
            -d text="${MESSAGE}" \
